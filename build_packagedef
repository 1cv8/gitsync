#Использовать logos
Перем Лог;

Процедура ПередСборкой(Знач РабочийКаталог) Экспорт

	Лог.Информация("Установка локальных зависимостей библиотек");
	КомандаOpm = Новый Команда;

	КомандаOpm.УстановитьКоманду("opm");
	КомандаOpm.ДобавитьПараметр("install -l");	

	КодВозврата = КомандаOpm.Исполнить();

	Если КодВозврата <> 0  Тогда
		ВызватьИсключение КомандаOpm.ПолучитьВывод();
	КонецЕсли;
	Лог.Информация("Настройка локальных библиотек");
	
	ПутьКФайлуЗагрузчику = ОбъединитьПути(РабочийКаталог, "oscript_modules", "package-loader.os");
	ШаблонныйФайлЗагрузчик = ОбъединитьПути(РабочийКаталог, "templates", "package-loader.os");
	ФайлЗагрузчик = Новый Файл(ПутьКФайлуЗагрузчику);
	Если Не ФайлЗагрузчик.Существует() Тогда
		КопироватьФайл(ШаблонныйФайлЗагрузчик, ПутьКФайлуЗагрузчику);
		Лог.Информация("Добавлен файл загрузки локальных библиотек");
	КонецЕсли;
	
	ПутьКФайлуНастройкиСкрипта = ОбъединитьПути(РабочийКаталог, "src", "cmd", "oscript.cfg");
	ШаблонныйФайлНастройкиСкрипта = ОбъединитьПути(РабочийКаталог, "templates", "oscript.cfg");
	ФайлНастройкиСкрипта= Новый Файл(ПутьКФайлуНастройкиСкрипта);
	Если Не ФайлНастройкиСкрипта.Существует() Тогда
		КопироватьФайл(ШаблонныйФайлНастройкиСкрипта, ПутьКФайлуНастройкиСкрипта);
		Лог.Информация("Добавлен файл настройки запуска");
	КонецЕсли;

КонецПроцедуры

Процедура ПриСборке(Знач РабочийКаталог, Знач АрхивПакета) Экспорт

КонецПроцедуры

Процедура ПослеСборки(Знач РабочийКаталог, Знач ПутьКФайлуПакета) Экспорт

КонецПроцедуры

Лог = Логирование.ПолучитьЛог(ПараметрыСистемыOpm.ИмяЛогаСистемы());

Описание.Имя("gitsync")
		.Версия("3.0.0-sc")
		.ВерсияСреды("1.0.18")
		.ВключитьФайл("src")
		.ВключитьФайл("oscript_modules")
		.ВключитьФайл("docs")
		//.ВключитьФайл("features")
		//.ВключитьФайл("bin")
		//.ВключитьФайл("config-example.xml")
		//.ВключитьФайл("config-example.json")
		.ВключитьФайл("readme.md")
		.ИсполняемыйФайл("src/cmd/gitsync.os");